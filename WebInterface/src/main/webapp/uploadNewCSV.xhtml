<html xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns="http://www.w3.org/1999/xhtml">


<h:head>
    <style>


    </style>


</h:head>

<h:body>
    <h1>Upload a new CSV data file</h1>

    <p>Provide a name first, then upload the file.</p>
    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
    <h:form enctype="multipart/form-data">
        <p:outputLabel value="Database schema"/>
        <h:selectOneMenu id="databaseDropDown" valueChangeListener="#{databaseTableNameBean.handleChangeDatabaseName}"
                         required="true" value="#{databaseTableNameBean.databaseName}"
                         binding="#{databaseNameDropdown}">
            <f:selectItems value="#{databaseTableNameBean.databaseNames}"/>
            <p:ajax update="databaseDropDown"/>
        </h:selectOneMenu>

        <p:outputLabel value="Tablename"/>
        <p:inputText required="true" requiredMessage="The table name is required"
                     value="#{fileUploadController.tableName}">
            <f:ajax event="blur"/>
        </p:inputText>

        <p:fileUpload fileUploadListener="#{fileUploadController.handleFileUpload}"
                      mode="advanced" update="messages, dt" auto="true"
                      sizeLimit="100000000"
                      allowTypes="/(\.|\/)(csv|txt)$/"/>
        <p:dataTable id="dt" var="filename" value="#{fileUploadController.filesListStrings}">
            <p:column>
                #{filename}
            </p:column>

        </p:dataTable>


        <p:growl id="messages" showDetail="true"/>
        <f:attribute name="uploadSessionType" value="newCSV"/>

    </h:form>

    <!-- primary column -->
    <p:separator/>
    <h:form id="primaryKeyForm">
        <p:outputLabel value="Primary key"/>
        <h:selectOneMenu id="primaryKeyDropDown" valueChangeListener="#{fileUploadController.handleChangePrimaryKey}"
                         required="true" value="#{databaseMigrationController.primaryKey}"
                         binding="#{primaryKeyDropDown}">
            <f:selectItems value="#{fileUploadController.CSVcolumnNames}"/>

            <f:ajax event="click"
                    render="primaryKeyDropDown"
                    listener="#{fileUploadController.updateCSVColumnList}"/>
            <p:ajax update="@this"/>
        </h:selectOneMenu>
        <p:commandButton id="primaryKeyButton" value="Select primary key."
                         action="#{databaseMigrationController.setPrimarKeyAction}">


        </p:commandButton>
        <h:message for="primaryKeyButton" id="primaryKeyMessage"/>

    </h:form>
    <p:separator/>
    <h:form>
        <p:commandButton value="Migrate into Database."
                         action="#{databaseMigrationController.migrate}">


        </p:commandButton>
        <p:commandButton action="table.xhtml?faces-redirect=true" value="View existing data"/>
    </h:form>


</h:body>
</html>