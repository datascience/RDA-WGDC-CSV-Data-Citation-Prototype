
<!--
  ~ Copyright [2014] [Stefan PrÃ¶ll]
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<html xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns="http://www.w3.org/1999/xhtml">


<h:head>
    <title>Data Citation Tool</title>

    <!-- CSS -->
    <link href="css/demo_page.css" rel="stylesheet" type="text/css"/>
    <link href="css/demo_table.css" rel="stylesheet" type="text/css"/>
    <link href="css/demo_table_jui.css" rel="stylesheet" type="text/css"/>
    <link href="css/jquery-ui-1.10.4.custom.css" rel="stylesheet"
          type="text/css" media="all"/>
    <link href="css/custom_table.css" rel="stylesheet" type="text/css"/>


    <!-- Scripts -->
    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="js/jquery.dataTables.js" type="text/javascript"></script>
    <script src="js/jquery.dataTables.columnFilter.js" type="text/javascript"></script>
    <script src="js/dataTables.tableTools.js" type="text/javascript"></script>

    <script type="text/javascript">


	 $(document).ready(function() {



			/* Initialise the DataTable */
			var oTable = $('#data_table').dataTable( {
				 "sAjaxSource": "/cite/csvdata",
				 "bServerSide": true,
				 "bProcessing": true,
			     "sPaginationType": "full_numbers",
			     "bJQueryUI": true,
			     "bAutoWidth": false,
			     "bPaginate": true,
		       	 "sScrollX": "100%",
		         "sScrollY": "800px",
		         "bScrollCollapse": true,
				 "aoColumns":<h:outputText value="#{servletController.mDataString}" escape="false"/>,

				 "fnServerData": function ( sSource, aoData, fnCallback ) {
	                    jQuery.ajax( {
	                        "dataType": 'json',
	                        "type": "GET",
	                        "url": sSource,
	                        "data": aoData,
	                        "success": fnCallback
	                    } );
	                },
	               "fnServerParams": function ( aoData ) {
	              	aoData.push(
	              			{ "name": "currentTable", "value": "<h:outputText value="#{servletController.currentTableName}" escape="false"/>"}
					);}				}).columnFilter();



 function submitTable() {
        var data = oTable.$('input, select').serialize();
        alert(
            "The following data would have been submitted to the server: \n\n"+
            data.substr( 0, 120 )+'...'
        );
        return false;
    };

	});





function AjaxUpdateDataSucceeded(result) {
    if (result != "[]") {
 //       alert("update ok");

    }
};

function AjaxUpdateDataFailed(result) {
    alert(result.status + ' ' + result.statusText);
};








    </script>


</h:head>

<h:body id="dt_data_table">
    <h:form>
        <h:selectOneMenu id="databaseDropDown" valueChangeListener="#{databaseTableNameBean.handleChangeDatabaseName}"
                         required="true" value="#{databaseTableNameBean.databaseName}"
                         binding="#{databaseNameDropdown}">
            <f:selectItems value="#{databaseTableNameBean.databaseNames}"/>
            <p:ajax update="tableDropDown"/>
        </h:selectOneMenu>
        <h:selectOneMenu id="tableDropDown" valueChangeListener="#{databaseTableNameBean.handleChangeTableName}"
                         required="#{not empty param[databaseTableNameBean.databaseNames]}"
                         value="#{databaseTableNameBean.tableName}">
            <f:selectItems value="#{databaseTableNameBean.tableNames}"/>
            <p:ajax update="@this"/>
        </h:selectOneMenu>


    </h:form>

    <div id="demo_jui">


        <table id="data_table" class="display">

            <!--  Table Headers -->
            <h:outputText value="#{servletController.tableHeadersAsHTML}" escape="false"/>

            <!--  Table Rows to show Datatables where to put the data -->
            <h:outputText value="#{servletController.tableFooterAsHTML}" escape="false"/>

            <!--  Table Rows to show Datatables where to put the data -->
            <h:outputText value="#{servletController.emptyTableHeaders}" escape="false"/>

            <tbody>
            </tbody>
        </table>
        <div id="buttonPlaceholder"></div>


        <h:form>
            <p:commandButton value="Initialize query store" action="#{queryStoreController.initializeQueryStore}"
                             onClick="submitTable()"></p:commandButton>
            <p:commandButton value="Store current selection"
                             action="#{queryStoreController.storeCurrentSelection}"></p:commandButton>
            <p:commandButton value="Finalize dataset"
                             action="#{queryStoreController.finalizeDataSet}"></p:commandButton>

        </h:form>


    </div>

</h:body>
</html>